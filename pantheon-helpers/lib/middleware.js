// Generated by IcedCoffeeScript 1.8.0-c
(function() {
  var basic_auth;

  basic_auth = require('basic-auth');

  module.exports = {
    auth: function(conf) {
      var SYSTEM_USER;
      SYSTEM_USER = conf.COUCHDB.SYSTEM_USER;
      return function(req, resp, next) {
        var credentials;
        credentials = basic_auth(req);
        if (conf.DEV || (credentials && credentials.name === SYSTEM_USER && credentials.pass === conf.COUCH_PWD)) {
          req.session || (req.session = {});
          req.session.user = SYSTEM_USER;
          return next();
        } else {
          return resp.status(401).end(JSON.stringify({
            error: "unauthorized",
            msg: "You are not authorized."
          }));
        }
      };
    },
    couch: function(couch_utils) {
      return function(req, resp, next) {
        req.couch = couch_utils.nano_user(req.session.user);
        return next();
      };
    }
  };

}).call(this);
